<!DOCTYPE html>
<html>
<head>
	<title>{{title}}</title>
	<link rel="stylesheet" type="text/css" href="../css/groupChat.css">
	<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script >
		
		$(function(){
			var host = '{{config.host}}';
			var messages = io.connect(host + '/messages');
			var groupNum = {{group_number}};
			var userName = '{{user.fullname}}';
			var userPic = '{{user.profilePic}}';

			messages.on('connect',function(){
				console.log('Connection....Estabilished....!!');
				messages.emit('joingroup',{group:groupNum,user:userName,userPic:userPic});
			})

			$(document).on('keyup','.newmessage',function(e){
				if(e.which === 13 && $(this).val()!=''){
					messages.emit('newMessage',{
						group_number:groupNum,
						user:userName,
						userPic:userPic,
						message:$(this).val()
					})
					updateMessageFeed(userPic,$(this).val());
					$(this).val('');
				}
			})

			// })
			messages.on('messagesfeed',function(data){
				var msgs = JSON.parse(data);
				updateMessageFeed(msgs.userPic,msgs.message);
				console.log(msgs+"msgs");
				// console.log(str+"str updateMessageFeed JSON.parser");
			})
			

			function updateMessageFeed(userPic, message){
				var str = '<li>';
				str+= '<div class="msgBox">';
				str+= '<div class="pic"><img src="'+userPic+'"></div>';
				str+= '<div class="msg"><p>'+message+'<p></div>';
				str+= '</div>';
				str+='</li>';
				$(str).appendTo($('.messages'));
				// $(str).prependTo($('.messages'));
				// $(str).hide().prependTo($('.messages')).slideDown(100);
				// console.log(str+"strupdateMessageFeed");
			}
		})

	</script>
</head>
<body>
	<div class="container">
		<h1>Chat Application</h1>
		<div class="userbox">
			<img src="{{user.profilePic}}" class="userImg">
			<h3 class="userName">{{user.fullname}} | <a href="/logout">logout</a> |  <a href="/chatIndex">moregroup</a></h3>
		</div>
		<div class="new_group_name">
			<h5>{{group_name}}</h5>
		</div>
		<!-- </input> -->
		<div class="Messagelist">
			<ul class="messages">
				<!-- <li>
					<div class="msgBox">
						<div class="pic"><img src="{{user.profilePic}}">{{user.fullname}}</div>
						<div class="msg"><p>Hellooo.....<p></div>
					</div>

				</li>
			-->			</ul>
		</div>
		<div class="group_user">
			<ui>
				<li><img src="{{user.profilePic}}"><h5>{{user.fullname}}</h5></li>
			</ui>
		</div>
		<div class="rm-newmessage">
			<input type="text" class="newmessage" autocomplete="off" placeholder="Type Your Message And Press Enter !"></input>
		</div>
	</div>
</body>
</html>